<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>(Und)ictionary</title>
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a clean typeface -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        /* Custom base styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Tailwind gray-50 */
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .blurred {
            filter: blur(20px);
            transition: filter 0.3s ease;
        }

        /* --- STYLES FOR INJECTED WIKTIONARY CONTENT --- */

        .definition-content { line-height: 1.6; }
        .definition-content h2, .definition-content h3, .definition-content h4, .definition-content h5 {
            font-weight: 700;
            margin-top: 1.75rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .definition-content h2 { font-size: 1.8rem; }
        .definition-content h3 { font-size: 1.5rem; }
        .definition-content h4 { font-size: 1.25rem; }
        .definition-content h5 { font-size: 1.1rem; }
        .definition-content summary h2, .definition-content summary h3, .definition-content summary h4, .definition-content summary h5 {
            display: inline-block;
            border-bottom: none;
            margin: 0;
            padding: 0;
        }
        .definition-content p { margin-bottom: 1rem; }
        .definition-content ul, .definition-content ol {
            margin-left: 1.25rem;
            margin-bottom: 1rem;
            list-style-position: outside;
        }
        .definition-content ul { list-style-type: disc; }
        .definition-content ol { list-style-type: decimal; }
        .definition-content li { margin-bottom: 0.75rem; padding-left: 0.5rem; }
        .definition-content a {
            color: #2563eb;
            text-decoration: none;
            border-bottom: 1px solid #93c5fd;
            cursor: pointer;
        }
        .definition-content a:hover { color: #1d4ed8; border-bottom-color: #1d4ed8; }
        .definition-content .IPA {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f3f4f6;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            border: 1px solid #e5e7eb;
            font-size: 0.9em;
        }
        .definition-content i, .definition-content .i { font-style: italic; }
        .definition-content b, .definition-content strong { font-weight: 600; }
        .definition-content .ib-content { color: #4b5563; font-size: 0.9em; }
        .definition-content .ib-content a { border-bottom: 1px dotted #6b7280; }
        .definition-content .audiotable { margin: 0.5rem 0; width: 100%; }
        .definition-content audio { width: 100%; max-width: 250px; height: 40px; }
        .definition-content details {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            background-color: #ffffff;
        }
        .definition-content summary {
            font-weight: 600;
            padding: 0.75rem 1rem;
            cursor: pointer;
            background-color: #f9fafb;
        }
        .definition-content details[open] > summary { border-bottom: 1px solid #e5e7eb; }
        .definition-content details > *:not(summary) { padding: 0 1rem 1rem 1rem; }
        .definition-content details > ol, .definition-content details > ul { padding: 0 1rem 1rem 2.5rem; }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <!-- Header Section -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900">(Und)ictionary</h1>
            <p class="text-gray-600 mt-2">Powered by Wiktionary, Wikimedia & Gemini</p>
        </header>

        <!-- Search Form -->
        <main>
            <form id="lookup-form" class="flex flex-col gap-4 mb-8">
                <div class="flex flex-col sm:flex-row gap-2">
                    <input id="dictionary-word" type="text" autocapitalize="off" autofocus="true" placeholder="Enter a word..." class="flex-grow w-75 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow">
                    <button id="dictionary-submit" type="submit" class="bg-blue-600 text-white font-bold px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center shadow">
                        <span id="button-text">Look up</span>
                        <svg id="button-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </div>
                 <!-- Language Selector -->
                <div class="flex-grow">
                    <select id="language-selector" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow bg-white">
                        <option value="en">English</option>
                        <option value="fr">French (Français)</option>
                        <option value="es">Spanish (Español)</option>
                        <option value="pt">Portuguese (Português)</option>
                        <option value="de">German (Deutsch)</option>
                        <option value="ja">Japanese (日本語)</option>
                        <option value="ru">Russian (Русский)</option>
                        <option value="zh">Chinese (中文)</option>
                    </select>
                </div>
            </form>

            <!-- Results Section -->
            <div id="results-container" class="space-y-6">
                <!-- Word Title -->
                <div id="word-display" class="hidden">
                    <h1 id="the-word" class="text-5xl font-bold capitalize text-gray-900 break-words"></h1>
                </div>

                <!-- Status/Error Messages -->
                <div id="status-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg" role="alert"></div>

                <!-- Images -->
                <div id="images-container" class="hidden">
                    <div id="the-images" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
                    <div id="grossness-warning" class="hidden text-center mt-4">
                        <p class="text-yellow-700 bg-yellow-100 p-3 rounded-lg">Warning: Images may contain sensitive content.</p>
                        <button id="reveal-grossness-button" class="mt-2 bg-yellow-500 text-white font-semibold px-4 py-2 rounded-lg hover:bg-yellow-600">Show Images</button>
                    </div>
                </div>

                <!-- Action Buttons & Gemini Output -->
                <div id="controls-and-output" class="hidden space-y-4">
                     <div id="action-buttons" class="bg-gray-50 border border-gray-200 p-4 rounded-lg flex flex-wrap items-center gap-4">
                        <button id="gemini-explain-btn" class="bg-purple-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2 disabled:bg-purple-300">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stars" viewBox="0 0 16 16"><path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.73 1.73 0 0 0 4.593 5.9l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.9A1.73 1.73 0 0 0 2.31 4.807l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.73 1.73 0 0 0 3.407 2.31zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.16 1.16 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.16 1.16 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732z"/></svg>
                            Explain Simply
                        </button>
                        <button id="goto-translations-btn" class="bg-green-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M2.5 8a5.5 5.5 0 0 1 11 0c0 1.456-.394 2.823-1.088 3.996a.5.5 0 0 1-.866-.5A4.5 4.5 0 0 0 13.5 8a4.5 4.5 0 0 0-9 0 4.5 4.5 0 0 0 1.954 3.496.5.5 0 1 1-.866.5A5.5 5.5 0 0 1 2.5 8m6.336 4.793a.5.5 0 0 1 .728 0l2 2a.5.5 0 0 1-.708.707L9.5 14.207v1.293a.5.5 0 0 1-1 0v-1.293l-1.354 1.353a.5.5 0 0 1-.708-.707zM3.5 8a.5.5 0 0 0-1 0v1.5a.5.5 0 0 0 1 0zm11 0a.5.5 0 0 0-1 0v1.5a.5.5 0 0 0 1 0zM12 8a.5.5 0 0 0-1 0v1.5a.5.5 0 0 0 1 0zm-7 0a.5.5 0 0 0-1 0v1.5a.5.5 0 0 0 1 0z"/></svg>
                            Go to Translations
                        </button>
                        <svg id="gemini-spinner" class="animate-spin h-6 w-6 text-purple-600 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </div>
                    <div id="gemini-output" class="bg-purple-50 border-l-4 border-purple-400 p-4 rounded-lg text-purple-900 hidden"></div>
                </div>

                <!-- Definition -->
                <div id="the-definition-content" class="definition-content bg-white p-6 rounded-lg shadow-sm border border-gray-200 hidden"></div>

            </div>
        </main>
    </div>

<script type="module">
    // --- DOM Element References ---
    const lookupForm = document.getElementById('lookup-form');
    const wordInput = document.getElementById('dictionary-word');
    const languageSelector = document.getElementById('language-selector');
    const submitButton = document.getElementById('dictionary-submit');
    const buttonText = document.getElementById('button-text');
    const buttonSpinner = document.getElementById('button-spinner');
    const wordDisplay = document.getElementById('word-display');
    const theWordElement = document.getElementById('the-word');
    const statusMessage = document.getElementById('status-message');
    const imagesContainer = document.getElementById('images-container');
    const theImagesElement = document.getElementById('the-images');
    const grossnessWarning = document.getElementById('grossness-warning');
    const revealGrossnessButton = document.getElementById('reveal-grossness-button');
    const definitionContent = document.getElementById('the-definition-content');
    const controlsAndOutput = document.getElementById('controls-and-output');
    const actionButtons = document.getElementById('action-buttons');
    const geminiExplainBtn = document.getElementById('gemini-explain-btn');
    const gotoTranslationsBtn = document.getElementById('goto-translations-btn');
    const geminiSpinner = document.getElementById('gemini-spinner');
    const geminiOutput = document.getElementById('gemini-output');

    // --- Language Data ---
    const languageData = {
        en: { name: 'English', mainSections: ['Proper noun', 'Noun', 'Verb', 'Adjective', 'Adverb', 'Pronoun', 'Preposition', 'Conjunction', 'Interjection'] },
        fr: { name: 'Français', mainSections: ['Nom commun', 'Verbe', 'Adjectif', 'Adverbe', 'Nom propre', 'Forme de verbe'] },
        es: { name: 'Español', mainSections: ['Sustantivo', 'Verbo', 'Adjetivo', 'Adverbio', 'Nombre propio'] },
        pt: { name: 'Português', mainSections: ['Substantivo', 'Verbo', 'Adjetivo', 'Advérbio', 'Nome próprio'] },
        de: { name: 'Deutsch', mainSections: ['Substantiv', 'Verb', 'Adjektiv', 'Adverb', 'Eigenname'] },
        ja: { name: '日本語', mainSections: ['名詞', '動詞', '形容詞', '副詞'] },
        ru: { name: 'Русский', mainSections: ['Существительное', 'Глагол', 'Прилагательное', 'Наречие'] },
        zh: { name: '中文', mainSections: ['名词', '动词', '形容词', '副词'] }
    };

    // --- Content Filters ---
    const naughtyRegex = /(vagina|condom|circumcised|ejaculation|ejaculate|erection|pubic|cum|pubes|bollock|vulva|clit|sex|penis|phallus|genital|ballsack|testicle|butt|ass|breast|boob|nipple|dildo|labia|masturbation|masturbate|semen|smegma)/i;
    const grossRegex = /(pus|blood|poop|excrement|urine|piss|shit)/i;

    // --- Event Listeners ---
    lookupForm.addEventListener('submit', handleFormSubmit);
    
    revealGrossnessButton.addEventListener('click', () => {
        theImagesElement.classList.remove('blurred');
        grossnessWarning.style.display = 'none';
    });

    definitionContent.addEventListener('click', (e) => {
        const link = e.target.closest('a[data-lookup="true"]');
        if (!link) return;
        e.preventDefault();
        try {
            const url = new URL(link.getAttribute('href'));
            let word = url.pathname.split('/').pop();
            if (word) {
                word = word.split('#')[0];
                wordInput.value = decodeURIComponent(word);
                window.scrollTo({ top: 0, behavior: 'smooth' });
                lookupForm.requestSubmit();
            }
        } catch (error) {
            console.error("Could not parse link:", error);
        }
    });

    geminiExplainBtn.addEventListener('click', callGeminiToExplain);
    
    gotoTranslationsBtn.addEventListener('click', () => {
        const translationsSection = definitionContent.querySelector('[id^="Translations"]');
        if (translationsSection) {
            translationsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    });

    // --- Main Functions ---

    async function handleFormSubmit(e) {
        e.preventDefault();
        const word = wordInput.value.trim();
        const lang = languageSelector.value;
        if (!word) return;

        resetUI();
        setLoadingState(true);

        try {
            if (naughtyRegex.test(word)) {
                throw new Error('This content has been determined to be inappropriate to display. Please search for another word.');
            }
            const [wiktionaryData, imageData] = await Promise.all([
                fetchWiktionaryData(word, lang),
                fetchImageData(word, lang)
            ]);

            renderResults(word, wiktionaryData, imageData);
        } catch (error) {
            renderError(error.message, word);
        } finally {
            setLoadingState(false);
        }
    }

    async function fetchWiktionaryData(word, lang) {
        const url = `https://${lang}.wiktionary.org/w/api.php?action=parse&origin=*&format=json&page=${encodeURIComponent(word)}`;
        const response = await fetch(url);
        if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
        const json = await response.json();

        if (json.error) {
            throw new Error(`The word "${word}" was not found in ${languageData[lang].name}.`);
        }
        
        const parser = new DOMParser();
        const doc = parser.parseFromString(json.parse.text['*'], "text/html");
        
        const langName = languageData[lang].name;
        const langHeaderSpan = doc.getElementById(langName);

        let contentSource = doc.body;
        if (langHeaderSpan) {
            const contentFragment = document.createDocumentFragment();
            let element = langHeaderSpan.parentElement; // This is the H2
            
            while (element) {
                // The section ends at a horizontal rule or the next H2 that is NOT the one we started with.
                if (element.tagName === 'HR' || (element.tagName === 'H2' && element !== langHeaderSpan.parentElement)) {
                    break;
                }
                contentFragment.appendChild(element.cloneNode(true));
                element = element.nextElementSibling;
            }
            contentSource = contentFragment;
        }
        
        return cleanHtml(contentSource, lang);
    }
    
    async function fetchImageData(word, lang) {
        const url = `https://commons.wikimedia.org/w/api.php?action=query&format=json&origin=*&prop=images&imlimit=8&redirects=1&titles=${encodeURIComponent(word)}&uselang=${lang}`;
        const response = await fetch(url);
        const json = await response.json();
        const images = [];
        if (!json.query || !json.query.pages) return [];
        const page = Object.values(json.query.pages)[0];
        if (!page.images) return [];
        for (const image of page.images) {
            const title = image.title;
            const ext = title.split('.').pop().toLowerCase();
            if (['jpg', 'jpeg', 'png', 'gif', 'svg', 'webp'].includes(ext)) {
                 images.push(`https://commons.wikimedia.org/wiki/Special:Redirect/file/${encodeURIComponent(title)}`);
            }
        }
        return images;
    }

    async function callGeminiToExplain() {
        const word = theWordElement.textContent;
        const definitionContainer = definitionContent.querySelector('ol');
        
        if (!definitionContainer) {
            geminiOutput.textContent = "Couldn't find a definition to explain.";
            geminiOutput.classList.remove('hidden');
            return;
        }

        const definitionText = definitionContainer.innerText.trim();
        const prompt = `Explain the word "${word}" in simple, easy-to-understand terms. Here is the dictionary definition for context: "${definitionText}"`;

        geminiSpinner.classList.remove('hidden');
        geminiOutput.classList.add('hidden');
        geminiExplainBtn.disabled = true;

        try {
            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
            const result = await response.json();

            if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                const text = result.candidates[0].content.parts[0].text;
                geminiOutput.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*/g, '').replace(/\n/g, '<br>');
                geminiOutput.classList.remove('hidden');
            } else {
                throw new Error("Unexpected API response structure.");
            }
        } catch (error) {
            console.error("Gemini API call failed:", error);
            geminiOutput.textContent = "Sorry, I couldn't get an explanation at this time.";
            geminiOutput.classList.remove('hidden');
        } finally {
            geminiSpinner.classList.add('hidden');
            geminiExplainBtn.disabled = false;
        }
    }

    // --- UI Rendering and Helper Functions ---

    function renderResults(word, definitionHtml, imageUrls) {
        wordDisplay.classList.remove('hidden');
        wordDisplay.classList.add('fade-in');
        theWordElement.textContent = word;

        if (definitionHtml && definitionHtml.childNodes.length > 0) {
            definitionContent.replaceChildren(definitionHtml);
            definitionContent.classList.remove('hidden');
            controlsAndOutput.classList.remove('hidden');

            // Show/hide the translations button based on content
            const translationsSection = definitionContent.querySelector('[id^="Translations"]');
            if (translationsSection) {
                gotoTranslationsBtn.classList.remove('hidden');
            } else {
                gotoTranslationsBtn.classList.add('hidden');
            }

        } else {
            const lang = languageSelector.value;
            renderError(`No definition found for "${word}" in the ${languageData[lang].name} section.`);
        }

        if (imageUrls.length > 0) {
            theImagesElement.innerHTML = imageUrls.map(url => `<div class="aspect-w-1 aspect-h-1"><img src="${url}" alt="Image related to ${word}" class="w-full h-full object-cover rounded-lg shadow-md" loading="lazy"></div>`).join('');
            imagesContainer.classList.remove('hidden');
            if (grossRegex.test(word)) {
                theImagesElement.classList.add('blurred');
                grossnessWarning.style.display = 'block';
            } else {
                theImagesElement.classList.remove('blurred');
                grossnessWarning.style.display = 'none';
            }
        }
    }

    function renderError(message, word) {
        let html = `<p>${message}</p>`;
        if (word && /[A-Z]/.test(word) && message.includes("not found")) {
            const lowerCaseWord = word.toLowerCase();
            html += `<p class="mt-2">This dictionary is case-sensitive. Try looking up <a href="#" id="retry-word" class="font-bold underline">${lowerCaseWord}</a> instead.</p>`;
        }
        statusMessage.innerHTML = html;
        statusMessage.classList.remove('hidden');
        const retryLink = document.getElementById('retry-word');
        if (retryLink) {
            retryLink.addEventListener('click', (e) => {
                e.preventDefault();
                wordInput.value = retryLink.textContent;
                lookupForm.requestSubmit();
            });
        }
    }
    
    function cleanHtml(fragment, lang) {
        fragment.querySelectorAll('.mw-editsection, .interproject-box, .noprint, style, .thumb, .gallery, figure, img').forEach(el => el.remove());
        fragment.querySelectorAll('.NavFrame').forEach(navFrame => {
            const details = document.createElement('details');
            const summary = document.createElement('summary');
            const head = navFrame.querySelector('.NavHead');
            if (head) {
                summary.append(...head.childNodes);
                details.appendChild(summary);
            }
            const content = navFrame.querySelector('.NavContent');
            if (content) details.append(...content.childNodes);
            navFrame.replaceWith(details);
        });
        
        const newNodes = [];
        const children = [...fragment.childNodes];
        let i = 0;
        while (i < children.length) {
            const node = children[i];
            const isHeading = node.nodeType === 1 && ['H2', 'H3', 'H4', 'H5'].includes(node.tagName);
            let shouldCollapse = false;
            if (isHeading) {
                const headingText = node.textContent.replace(/\[edit\]/g, '').trim();
                const isMainSection = languageData[lang].mainSections.some(section => headingText.toLowerCase().startsWith(section.toLowerCase()));
                if (!isMainSection) shouldCollapse = true;
            }

            if (shouldCollapse) {
                const details = document.createElement('details');
                const summary = document.createElement('summary');
                summary.appendChild(node);
                details.appendChild(summary);
                let nextIndex = i + 1;
                while (nextIndex < children.length) {
                    const nextNode = children[nextIndex];
                    if (nextNode.nodeType === 1 && ['H2', 'H3', 'H4', 'H5'].includes(nextNode.tagName)) break;
                    details.appendChild(nextNode);
                    nextIndex++;
                }
                newNodes.push(details);
                i = nextIndex;
            } else {
                newNodes.push(node);
                i++;
            }
        }

        const newFragment = document.createDocumentFragment();
        newFragment.append(...newNodes);

        newFragment.querySelectorAll('a').forEach(a => {
            let href = a.getAttribute('href');
            if (!href) return;
            const wiktionaryUrl = `https://${lang}.wiktionary.org`;
            if (href.startsWith('/wiki/')) href = `${wiktionaryUrl}${href}`;
            else if (href.startsWith('/w/')) href = `${wiktionaryUrl}${href}`;
            a.href = href;
            if (href.includes('wiktionary.org/wiki/')) a.dataset.lookup = 'true';
            else { a.target = '_blank'; a.rel = 'noopener noreferrer'; }
        });
        
        return newFragment;
    }

    function setLoadingState(isLoading) {
        submitButton.disabled = isLoading;
        buttonText.classList.toggle('hidden', isLoading);
        buttonSpinner.classList.toggle('hidden', !isLoading);
    }
    
    function resetUI() {
        wordDisplay.classList.add('hidden');
        statusMessage.classList.add('hidden');
        imagesContainer.classList.add('hidden');
        definitionContent.classList.add('hidden');
        definitionContent.innerHTML = '';
        controlsAndOutput.classList.add('hidden');
        geminiOutput.classList.add('hidden');
        gotoTranslationsBtn.classList.add('hidden');
        grossnessWarning.style.display = 'none';
        theImagesElement.classList.remove('blurred');
    }
</script>
</body>
</html>
